{
    "$schema": "https://raw.githubusercontent.com/Azure/azure-devtestlab/master/schemas/2015-01-01/dtlArtifacts.json",
    "title": "VSTS Build Agent",
    "description": "Downloads and installs the build agent, registers with the specified Visual Studio Team Services account, and adds the VM to the specified agent pool.",
    "tags": [
        "VSTS",
        "Build",
        "CI",
        "Windows"
    ],
    "iconUri": "",
    "targetOsType": "Windows",
    "parameters": {
        "vstsAccount": {
            "type": "string",
            "displayName": "VSTS Account",
            "description": "The name of the VSTS account to add the build agent to. This is the value of in your VSTS URL: e.g. 'myaccount' in https://myaccount.visualstudio.com."
        },
        "vstsUser": {
            "type": "string",
            "displayName": "VSTS User",
            "description": "User login name for a user with permissions to add build agents."
        },
        "vstsPassword": {
            "type": "securestring",
            "displayName": "VSTS Password",
            "description": "Password for the user with permissions to add build agents."
        },
        "agentName": {
            "type": "string",
            "displayName": "Agent Name",
            "description": "The name to give to the agent as seen by VSTS."
        },
        "poolName": {
            "type": "string",
            "displayName": "Agent Pool",
            "description": "The agent pool this build agent should be added to."
        }
    },
    "runCommand": {
        "commandToExecute": "[concat('powershell.exe -ExecutionPolicy bypass -File vsts-agent-install.ps1 ', parameters('vstsAccount'), ' ', parameters('vstsUser'), ' ', parameters('vstsPassword'), ' ', parameters('agentName'), ' ', parameters('poolName'))]"
    }
}
